module.exports=function(t){var n={};function e(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=n,e.d=function(t,n,a){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(a,o,function(n){return t[n]}.bind(null,o));return a},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=25)}([function(t,n){t.exports=flarum.core.compat.Model},function(t,n){t.exports=flarum.core.compat["helpers/icon"]},function(t,n){t.exports=flarum.core.compat["common/components/Button"]},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n){t.exports=flarum.core.compat["tags/helpers/tagsLabel"]},function(t,n){t.exports=flarum.core.compat["tags/models/Tag"]},function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat["utils/mixin"]},function(t,n){t.exports=flarum.core.compat["admin/components/ExtensionPage"]},function(t,n){t.exports=flarum.core.compat["common/Component"]},function(t,n){t.exports=flarum.core.compat.Component},function(t,n){t.exports=flarum.core.compat["components/Placeholder"]},function(t,n){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,n){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,n){t.exports=flarum.core.compat["helpers/avatar"]},function(t,n){t.exports=flarum.core.compat["helpers/username"]},function(t,n){t.exports=flarum.core.compat["components/SettingsModal"]},function(t,n){t.exports=flarum.core.compat["components/Switch"]},function(t,n){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,n){t.exports=flarum.core.compat["common/components/Select"]},function(t,n){t.exports=flarum.core.compat["common/utils/Stream"]},function(t,n){t.exports=flarum.core.compat["utils/ItemList"]},function(t,n){t.exports=flarum.core.compat["components/Dropdown"]},function(t,n){t.exports=flarum.core.compat["components/Modal"]},function(t,n){t.exports=flarum.extensions["sycho-uikit"]},function(t,n,e){"use strict";e.r(n);var a=e(6),o=e.n(a);function i(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}var s=e(0),r=e.n(s),c=e(7),u=function(t){function n(){return t.apply(this,arguments)||this}return i(n,t),n}(e.n(c)()(r.a,{id:r.a.attribute("id"),name:r.a.attribute("name"),type:r.a.attribute("type"),actor:r.a.hasOne("actor"),resourceType:r.a.attribute("resource_type"),resourceId:r.a.attribute("resource_id"),createdAt:r.a.attribute("created_at",r.a.transformDate),format:r.a.attribute("format"),discussion:r.a.hasOne("discussion"),post:r.a.hasOne("post"),group:r.a.hasOne("group"),user:r.a.hasOne("user")})),l=e(8),p=e.n(l),f=e(9),d=e.n(f),h=e(10),g=e.n(h),y=e(11),v=e.n(y),b=e(12),N=e.n(b),x=e(13),L=e.n(x),k=e(14),S=e.n(k),A=e(15),O=e.n(A),T=e(1),P=e.n(T),w=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.state=this.attrs.state},e.view=function(){if(this.state.loading)return m(N.a,{className:"LoadingIndicator--block"});if(!this.state.entries.length)return m(v.a,{text:app.translator.trans("sycho-action-log.admin.no_entries")});var t=this.state.controls.actions().icons;return m("div",{className:"ActionLogGrid"},this.state.entries.map((function(n){return m("div",{className:"ActionLogGrid-item"},m("div",{className:"ActionLogGrid-itemIcon"},m("div",{className:"ActionLogGrid-itemIconMain"},P()(t.resourceTypes[n.resourceType()]),m("span",{className:"ActionLogGrid-itemIconSecondary Badge",title:n.name(),oncreate:function(t){return $(t.dom).tooltip({placement:"bottom"})}},P()(t.actionNames[n.name()])))),m("div",{className:"ActionLogGrid-Avatar"},S()(n.actor())),m("div",{className:"ActionLogGrid-itemContent"},m("div",{className:"ActionLogGrid-entryActor"},O()(n.actor())),m("div",{className:"ActionLogGrid-entryName"},n.formattedName),m("div",{className:"ActionLogGrid-entryDetails"},m("div",{className:"ActionLogGrid-entryType"},n.type()),m("div",{className:"ActionLogGrid-entryTime"},P()("far fa-clock")," ",L()(n.createdAt())))))})))},n}(g.a),j=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.state=this.attrs.state,this.state.load()},e.view=function(){return m("div",{className:"ActionLogListSection"},m("div",{className:"ExtensionPage-permissions-header"},m("div",{className:"container"},m("h2",{className:"ExtensionTitle"},app.translator.trans("sycho-action-log.admin.total_entries",{count:this.state.total||"0"})))),m("div",{className:"ActionLogListSection-content"},m("div",{className:"container"},m("div",{className:"ActionLogListSection-navigation"},this.state.controls.filterControls(this).toArray()),m(w,{state:this.state}),m("div",{className:"ActionLogListSection-navigation"},this.state.buildPagination()))))},n}(d.a),_=e(16),B=e.n(_),C=e(17),E=e.n(C),I=e(3),G=e.n(I),q=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.excludedLoggingSetting=this.setting("sycho-action-log.excluded_logging",JSON.stringify([]))},e.title=function(){return app.translator.trans("sycho-action-log.admin.settings")},e.form=function(){var t=this,n=this.attrs.actions.items,e=this.attrs.actions.icons;return[m("p",null,app.translator.trans("sycho-action-log.admin.action_settings")),Object.keys(n).map((function(a){return m("div",{className:"ActionLogSettings-logTypes"},m("h3",null,m("span",null,app.translator.trans("sycho-action-log.admin.actions."+a+".label"))),Object.keys(n[a]).map((function(o){return m("div",{className:"ActionLogSettings-resourceTypes"},m("h4",null,app.translator.trans("sycho-action-log.admin.actions."+a+"."+o+".label"),m("span",{className:"ActionLog-titleIcon"},P()(e.resourceTypes[o]))),n[a][o].map((function(n){return m("div",{className:"Form-group"},m(E.a,{state:!t.getExcludedLoggingValue().includes(a+"."+o+"."+n),onchange:t.switch.bind(t,a,o,n)},app.translator.trans("sycho-action-log.admin.actions."+a+"."+o+"."+n+".label"),m("span",{className:"ActionLog-titleIcon"},P()(e.actionNames[n]))))})))})))}))]},e.getExcludedLoggingValue=function(){return JSON.parse(this.excludedLoggingSetting())},e.switch=function(t,n,e,a){var o=t+"."+n+"."+e,i=this.getExcludedLoggingValue();a?i=i.filter((function(t){return t!==o})):i.push(o),this.excludedLoggingSetting(JSON.stringify(i))},n}(B.a),M=e(18),K=e.n(M),R=e(2),D=e.n(R),J=e(19),z=e.n(J),V=e(20),F=e.n(V),H=e(21),U=e.n(H),Q=e(22),W=e.n(Q),X=e(23),Y=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.content=function(){return m("div",{className:"Modal-body"},app.translator.trans("sycho-action-log.admin.gambits.description"),m("ul",null,this.gambits().map((function(t){return m("li",null,m("strong",null,t,":")," ",app.translator.trans("sycho-action-log.admin.gambits.items."+t))}))))},e.title=function(){return app.translator.trans("sycho-action-log.admin.gambits.label")},e.gambits=function(){return["type","action","resource","actor"]},n}(e.n(X).a),Z=e(24).uikit.Input,tt=function(){function t(t){this.state=t}var n=t.prototype;return n.filterControls=function(){var t=this,n=new U.a;return n.add("search",m(Z,{icon:"fas fa-filter",parentClassName:"ActionLog-search",className:"FormControl",placeholder:app.translator.trans("sycho-action-log.admin.search"),value:this.state.query(),oninput:this.search.bind(this)})),n.add("help",m(G.a,{className:"Button Button--icon",icon:"fas fa-question",onclick:function(){return app.modal.show(Y)}})),n.add("sort",m(W.a,{buttonClassName:"Button",label:app.translator.trans("sycho-action-log.admin.sort."+this.state.sort)},Object.keys(this.state.sortingOptions).map((function(n){var e=t.state.sort===n;return m(G.a,{icon:!e||"fas fa-check",onclick:t.updateSort.bind(t,n),active:e},app.translator.trans("sycho-action-log.admin.sort."+n))})))),n.add("pagination",m("div",null,this.state.buildPagination())),n.add("refresh",m(G.a,{className:"Button Button--icon",icon:"fas fa-sync",onclick:this.state.load.bind(this.state)})),n},n.actions=function(){return{items:{moderation:{discussion:["locked","unlocked","hidden","restored","deleted","stickied","unstickied","tagged","renamed"],user:["suspended","unsuspended","activated"],post:["approved"]},administration:{group:["created","deleted"],tag:["created","deleted"],extension:["enabled","disabled","uninstalled"],permission:["edited"]}},icons:{resourceTypes:{discussion:"fas fa-comments",user:"fas fa-user",post:"fas fa-reply",extension:"fas fa-puzzle-piece",group:"fas fa-user-friends",tag:"fas fa-tag",permission:"fas fa-key"},actionNames:{locked:"fas fa-lock",unlocked:"fas fa-unlock",deleted:"fas fa-trash",stickied:"fas fa-thumbtack",unstickied:"fas fa-thumbtack",suspended:"fas fa-ban",unsuspended:"fas fa-check",approved:"fas fa-check",created:"fas fa-plus",enabled:"fas fa-check",disabled:"fas fa-ban",uninstalled:"fas fa-times",tagged:"fas fa-tag",renamed:"fas fa-pencil-alt",hidden:"fas fa-eye-slash",restored:"fas fa-reply",activated:"fas fa-bolt",edited:"fas fa-cog"}}}},n.updateSort=function(t){this.state.load({sort:t})},n.search=function(t){var n=this;this.state.query(t.target.value),this.state.loading=!0,this.searching=function(){return n.state.load({query:n.state.query()})},this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(this.searching,250)},t}();var nt,et,at,ot=e(4),it=e.n(ot),st=e(5),rt=e.n(st),ct=function(){function t(t){this.entry=t,this.langKey="sycho-action-log.admin.actions."+t.type()}var n=t.prototype;return n.handle=function(){this.entry.resourceType().length&&(this.langKey+="."+this.entry.resourceType()),this.langKey+="."+this.entry.name()+".action";var t=this.entry.resourceType()+this.entry.name().charAt(0).toUpperCase()+this.entry.name().slice(1);return this[t]?this[t]():this.genericHandler()},n.genericHandler=function(){var t=this,n=this.entry.format();return Object.keys(n).map((function(e,a){if("object"==typeof n[e]){var o=n[e].type||e;t[o]||(o="guessResourceName"),n["user"===e?"u":e]=t[o](t.entry.format()[e]||{},e),"user"===e&&delete n.user}})),Object.keys(n).map((function(t,e){n[t]=m("strong",null,n[t])})),app.translator.trans(this.langKey,n)},n.guessResourceName=function(t,n){var e=this;if(void 0!==t.items&&t.items.length)return t.items.map((function(n){return e.guessResourceName(n,t.type)}));var a=t.title||"";return t.id&&(t.version="#"+t.id),t.version&&(a=[a,m("i",null," (",t.version,")")]),t.icon&&(a=[m("span",{className:"Badge ActionLogExtensionIcon",style:t.icon},P()(t.icon.name)),a]),t.link&&(a=m("a",{href:t.link},a)),a},n.discussionTagged=function(){var n=this.entry.format();Object.keys(n.tags.items).length&&Object.keys(n.oldTags.items).length?this.langKey+=".add_remove":Object.keys(n.tags.items).length?this.langKey+=".add":this.langKey+=".remove";var e=function(n){return app.translator.transChoice(t.tagsText,Object.keys(n).length,{tags:it()(Object.keys(n).map((function(t){return new rt.a({attributes:n[t]})})))})};return n.tags=e(n.tags.items),n.oldTags=e(n.oldTags.items),n.discussion=m("strong",null,this.guessResourceName(n,"discussion")),app.translator.trans(this.langKey,n)},n.tag=function(t,n){return it()([new rt.a({attributes:t})])},n.groups=function(t){return t.items.map((function(t){return m("span",{className:"Badge ActionLogExtensionIcon",title:t.name,oncreate:function(t){return $(t.dom).tooltip({placement:"top"})},style:{backgroundColor:t.icon.backgroundColor}},P()(t.icon.name))}))},n.permission=function(t){return m("code",null,t.title)},t}();at="sycho-action-log.admin.actions.moderation.discussion.tagged.action.tags_text",(et="tagsText")in(nt=ct)?Object.defineProperty(nt,et,{value:at,enumerable:!0,configurable:!0,writable:!0}):nt[et]=at;var ut=function(){function t(){this.entries=[],this.sortingOptions={newest:"-createdAt",oldest:"createdAt"},this.sort="newest",this.offset=0,this.limit=20,this.total=0,this.count=0,this.page=0,this.query=F()(""),this.controls=new tt(this)}var n=t.prototype;return n.load=function(t){var n=this;this.loading=!0,app.store.find("action-log-entries",this.requestParams(t||{})).then(this.handleResponse.bind(this)).then((function(){n.loading=!1,m.redraw()}))},n.requestParams=function(t){var n=t.offset,e=t.query,a=t.sort;return void 0!==n&&(this.offset=n),void 0!==a&&(this.sort=a),{page:{offset:this.offset,limit:this.limit},filter:{q:e},sort:this.sortingOptions[this.sort]}},n.handleResponse=function(t){var n=this;return this.entries=t,this.total=t.payload.meta.total||0,this.count=t.payload.meta.count||0,this.links=t.payload.links,this.page=Math.ceil(this.offset/this.limit),this.entries=this.entries.filter((function(t){return!(!n.isTagsEnabled()&&("tag"===t.resourceType()||"tagged"===t.name()))})),this.entries.map((function(t){t.formattedName=n.formatName(t)})),t},n.buildPagination=function(){return this.count<=this.limit?m("div",{className:"ActionLogListSection-pagination"}):m("div",{className:"ActionLogListSection-pagination"},m(D.a,{className:"Button Button--icon",icon:"fas fa-arrow-left",onclick:this.prev.bind(this),disabled:!this.hasPrev()}),m(z.a,{value:this.page,options:this.getPages(),onchange:this.changePage.bind(this)}),m(D.a,{className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:this.next.bind(this),disabled:!this.hasNext()}))},n.next=function(){this.hasNext()&&this.load({offset:this.offset+this.limit})},n.prev=function(){this.hasPrev()&&this.load({offset:this.offset-this.limit})},n.hasNext=function(){return this.offset+this.limit<this.count},n.hasPrev=function(){return this.links.prev},n.getPages=function(){var t=Array.from({length:Math.ceil(this.count/this.limit)},(function(t,n){return n+1}));return t.map((function(n,e){t[e]=app.translator.trans("sycho-action-log.admin.page",{number:n})})),t},n.changePage=function(t){Object.keys(this.getPages()).includes(t)&&this.load({offset:t*this.limit})},n.formatName=function(t){return new ct(t).handle()},n.isTagsEnabled=function(){return-1!==JSON.parse(app.data.settings.extensions_enabled).indexOf("flarum-tags")},n.clear=function(){var t=this;confirm(app.translator.trans("sycho-action-log.admin.clear_confirmation"))&&(this.loading=!0,app.request({url:app.forum.attribute("apiUrl")+"/action-log-entries",method:"DELETE"}).then((function(){return t.load()})))},t}(),lt=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.actionLogSectionState=new ut},e.sections=function(){var n=t.prototype.sections.call(this);return n.replace("content",this.content(),2),n.add("actionLogList",m(j,{state:this.actionLogSectionState}),1),n},e.content=function(){return m("div",{className:"ExtensionPage-settings"},m("div",{className:"container ActionLogPage-mainControls"},this.mainControls().toArray()))},e.mainControls=function(){var t=this,n=new K.a;return n.add("clear",m(D.a,{className:"Button Button--primary",icon:"fas fa-trash",onclick:this.actionLogSectionState.clear.bind(this.actionLogSectionState)},app.translator.trans("sycho-action-log.admin.clear"))),n.add("settings",m(D.a,{className:"Button",icon:"fas fa-cogs",onclick:function(){return app.modal.show(q,{actions:t.actionLogSectionState.controls.actions()})}},app.translator.trans("sycho-action-log.admin.settings"))),n},n}(p.a);o.a.initializers.add("sycho-action-log",(function(t){t.store.models["action-log-entries"]=u,t.extensionData.for("sycho-action-log").registerPage(lt)}),-90)}]);
//# sourceMappingURL=admin.js.map