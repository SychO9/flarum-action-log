module.exports=function(t){var n={};function o(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=t,o.c=n,o.d=function(t,n,e){o.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,n){if(1&n&&(t=o(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)o.d(e,a,function(n){return t[n]}.bind(null,a));return e},o.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(n,"a",n),n},o.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},o.p="",o(o.s=26)}([function(t,n){t.exports=flarum.core.compat.Model},function(t,n){t.exports=flarum.core.compat["helpers/icon"]},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n){t.exports=flarum.core.compat.Component},function(t,n){t.exports=flarum.core.compat["utils/ItemList"]},function(t,n){t.exports=flarum.core.compat["tags/helpers/tagsLabel"]},function(t,n){t.exports=flarum.core.compat["tags/models/Tag"]},function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat["utils/mixin"]},function(t,n){t.exports=flarum.core.compat.extend},function(t,n){t.exports=flarum.core.compat["components/Page"]},function(t,n){t.exports=flarum.core.compat["components/Select"]},function(t,n){t.exports=flarum.core.compat["utils/Stream"]},function(t,n){t.exports=flarum.core.compat["components/Dropdown"]},function(t,n){t.exports=flarum.core.compat["utils/withAttr"]},function(t,n){t.exports=flarum.core.compat["components/SettingsModal"]},function(t,n){t.exports=flarum.core.compat["components/Switch"]},function(t,n){t.exports=flarum.core.compat["components/Modal"]},function(t,n){t.exports=flarum.core.compat["components/Placeholder"]},function(t,n){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,n){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,n){t.exports=flarum.core.compat["helpers/avatar"]},function(t,n){t.exports=flarum.core.compat["helpers/username"]},function(t,n){t.exports=flarum.core.compat["components/AdminNav"]},function(t,n){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,n){t.exports=flarum.core},function(t,n,o){"use strict";function e(){return(e=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])}return t}).apply(this,arguments)}o.r(n);var a=o(7),i=o.n(a);function s(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}var r=o(0),c=o.n(r),l=o(8),u=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),n}(o.n(l)()(c.a,{id:c.a.attribute("id"),name:c.a.attribute("name"),type:c.a.attribute("type"),actor:c.a.hasOne("actor"),resourceType:c.a.attribute("resource_type"),resourceId:c.a.attribute("resource_id"),createdAt:c.a.attribute("created_at",c.a.transformDate),format:c.a.attribute("format"),discussion:c.a.hasOne("discussion"),post:c.a.hasOne("post"),group:c.a.hasOne("group"),user:c.a.hasOne("user")})),p=o(9),f=o(10),d=o.n(f),h=o(1),g=o.n(h),y=o(2),v=o.n(y),b=o(11),N=o.n(b),x=o(12),L=o.n(x),A=o(4),k=o.n(A),O=o(13),T=o.n(O),P=o(14),j=o.n(P),w=o(3),S=o.n(w),_=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var o=n.prototype;return o.view=function(){this.attrs.className=this.attrs.className||"",this.attrs.className+=" ActionLog-FormControl",this.attrs.icon&&(this.attrs.className+=" hasIcon");var t="ActionLog-input "+(this.attrs.parentClassName||"");return m("div",{className:t},this.icon(),m("input",this.attrs))},o.icon=function(){if(this.attrs.icon){var t=this.attrs.icon;return delete this.attrs.icon,m("span",{class:"ActionLog-inputIcon"},g()(t))}},n}(S.a),B=o(15),C=o.n(B),I=o(16),M=o.n(I),G=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var o=n.prototype;return o.oninit=function(n){t.prototype.oninit.call(this,n),this.excludedLoggingSetting=this.setting("sycho-action-log.excluded_logging",JSON.stringify([]))},o.title=function(){return app.translator.trans("sycho-action-log.admin.settings")},o.form=function(){var t=this,n=this.attrs.actions.items,o=this.attrs.actions.icons;return[m("p",null,app.translator.trans("sycho-action-log.admin.action_settings")),Object.keys(n).map((function(e){return m("div",{className:"ActionLogSettings-logTypes"},m("h3",null,m("span",null,app.translator.trans("sycho-action-log.admin.actions."+e+".label"))),Object.keys(n[e]).map((function(a){return m("div",{className:"ActionLogSettings-resourceTypes"},m("h4",null,app.translator.trans("sycho-action-log.admin.actions."+e+"."+a+".label"),m("span",{className:"ActionLog-titleIcon"},g()(o.resourceTypes[a]))),n[e][a].map((function(n){return m("div",{className:"Form-group"},m(M.a,{state:!t.getExcludedLoggingValue().includes(e+"."+a+"."+n),onchange:t.switch.bind(t,e,a,n)},app.translator.trans("sycho-action-log.admin.actions."+e+"."+a+"."+n+".label"),m("span",{className:"ActionLog-titleIcon"},g()(o.actionNames[n]))))})))})))}))]},o.getExcludedLoggingValue=function(){return JSON.parse(this.excludedLoggingSetting())},o.switch=function(t,n,o,e){var a=t+"."+n+"."+o,i=this.getExcludedLoggingValue();e?i=i.filter((function(t){return t!==a})):i.push(a),this.excludedLoggingSetting(JSON.stringify(i))},n}(C.a),q=o(17),E=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var o=n.prototype;return o.content=function(){return m("div",{className:"Modal-body"},app.translator.trans("sycho-action-log.admin.gambits.description"),m("ul",null,this.gambits().map((function(t){return m("li",null,m("strong",null,t,":")," ",app.translator.trans("sycho-action-log.admin.gambits.items."+t))}))))},o.title=function(){return app.translator.trans("sycho-action-log.admin.gambits.label")},o.gambits=function(){return["type","action","resource","actor"]},n}(o.n(q).a),K=function(){function t(t){this.component=t}var n=t.prototype;return n.mainControls=function(){var t=this,n=new k.a;return n.add("clear",m(v.a,{className:"Button Button--primary",icon:"fas fa-trash",onclick:this.clear.bind(this)},app.translator.trans("sycho-action-log.admin.clear"))),n.add("settings",m(v.a,{className:"Button",icon:"fas fa-cogs",onclick:function(){return app.modal.show(G,{actions:t.actions()})}},app.translator.trans("sycho-action-log.admin.settings"))),n},n.filterControls=function(){var t=this,n=new k.a;return n.add("search",m(_,{icon:"fas fa-filter",parentClassName:"ActionLog-search",className:"FormControl",placeholder:app.translator.trans("sycho-action-log.admin.search"),value:this.component.query(),oninput:this.search.bind(this)})),n.add("help",m(v.a,{className:"Button Button--icon",icon:"fas fa-question",onclick:function(){return app.modal.show(E)}})),n.add("sort",m(T.a,{buttonClassName:"Button",label:app.translator.trans("sycho-action-log.admin.sort."+this.component.sort)},Object.keys(this.component.sortingOptions).map((function(n){var o=t.component.sort===n;return m(v.a,{icon:!o||"fas fa-check",onclick:t.updateSort.bind(t,n),active:o},app.translator.trans("sycho-action-log.admin.sort."+n))})))),n.add("pagination",m("div",null,this.component.buildPagination())),n.add("refresh",m(v.a,{className:"Button Button--icon",icon:"fas fa-sync",onclick:this.component.load.bind(this.component)})),n},n.actions=function(){return{items:{moderation:{discussion:["locked","unlocked","hidden","restored","deleted","stickied","unstickied","tagged","renamed"],user:["suspended","unsuspended","activated"],post:["approved"]},administration:{group:["created","deleted"],tag:["created","deleted"],extension:["enabled","disabled","uninstalled"],permission:["edited"]}},icons:{resourceTypes:{discussion:"fas fa-comments",user:"fas fa-user",post:"fas fa-reply",extension:"fas fa-puzzle-piece",group:"fas fa-user-friends",tag:"fas fa-tag",permission:"fas fa-key"},actionNames:{locked:"fas fa-lock",unlocked:"fas fa-unlock",deleted:"fas fa-trash",stickied:"fas fa-thumbtack",unstickied:"fas fa-thumbtack",suspended:"fas fa-ban",unsuspended:"fas fa-check",approved:"fas fa-check",created:"fas fa-plus",enabled:"fas fa-check",disabled:"fas fa-ban",uninstalled:"fas fa-times",tagged:"fas fa-tag",renamed:"fas fa-pencil-alt",hidden:"fas fa-eye-slash",restored:"fas fa-reply",activated:"fas fa-bolt",edited:"fas fa-cog"}}}},n.updateSort=function(t){this.component.load({sort:t})},n.search=function(){var t=this;j()("value",this.component.query)(),this.component.loading=!0,this.searching=function(){return t.component.load({query:t.component.query()})},this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(this.searching,250)},n.clear=function(){var t=this;confirm(app.translator.trans("sycho-action-log.admin.clear_confirmation"))&&(this.component.loading=!0,app.request({url:app.forum.attribute("apiUrl")+"/action-log-entries",method:"DELETE"}).then((function(){return t.component.load()})))},t}();var R,D,F,J=o(5),z=o.n(J),H=o(6),V=o.n(H),U=function(){function t(t){this.entry=t,this.langKey="sycho-action-log.admin.actions."+t.type()}var n=t.prototype;return n.handle=function(){this.entry.resourceType().length&&(this.langKey+="."+this.entry.resourceType()),this.langKey+="."+this.entry.name()+".action";var t=this.entry.resourceType()+this.entry.name().charAt(0).toUpperCase()+this.entry.name().slice(1);return this[t]?this[t]():this.genericHandler()},n.genericHandler=function(){var t=this,n=this.entry.format();return Object.keys(n).map((function(o,e){if("object"==typeof n[o]){var a=n[o].type||o;t[a]||(a="guessResourceName"),n["user"===o?"u":o]=t[a](t.entry.format()[o]||{},o),"user"===o&&delete n.user}})),Object.keys(n).map((function(t,o){n[t]=m("strong",null,n[t])})),app.translator.trans(this.langKey,n)},n.guessResourceName=function(t,n){var o=this;if(void 0!==t.items&&t.items.length)return t.items.map((function(n){return o.guessResourceName(n,t.type)}));var e=t.title||"";return t.id&&(t.version="#"+t.id),t.version&&(e=[e,m("i",null," (",t.version,")")]),t.icon&&(e=[m("span",{className:"Badge ActionLogExtensionIcon",style:t.icon},g()(t.icon.name)),e]),t.link&&(e=m("a",{href:t.link},e)),e},n.discussionTagged=function(){var n=this.entry.format();Object.keys(n.tags.items).length&&Object.keys(n.oldTags.items).length?this.langKey+=".add_remove":Object.keys(n.tags.items).length?this.langKey+=".add":this.langKey+=".remove";var o=function(n){return app.translator.transChoice(t.tagsText,Object.keys(n).length,{tags:z()(Object.keys(n).map((function(t){return new V.a({attributes:n[t]})})))})};return n.tags=o(n.tags.items),n.oldTags=o(n.oldTags.items),n.discussion=m("strong",null,this.guessResourceName(n,"discussion")),app.translator.trans(this.langKey,n)},n.tag=function(t,n){return z()([new V.a({attributes:t})])},n.groups=function(t){return t.items.map((function(t){return m("span",{className:"Badge ActionLogExtensionIcon",title:t.name,oncreate:function(t){return $(t.dom).tooltip({placement:"top"})},style:{backgroundColor:t.icon.backgroundColor}},g()(t.icon.name))}))},n.permission=function(t){return m("code",null,t.title)},t}();F="sycho-action-log.admin.actions.moderation.discussion.tagged.action.tags_text",(D="tagsText")in(R=U)?Object.defineProperty(R,D,{value:F,enumerable:!0,configurable:!0,writable:!0}):R[D]=F;var Q=o(18),W=o.n(Q),X=o(19),Y=o.n(X),Z=o(20),tt=o.n(Z),nt=o(21),ot=o.n(nt),et=o(22),at=o.n(et),it=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),n.prototype.view=function(){if(this.attrs.loading)return m(Y.a,{className:"LoadingIndicator--block"});if(!this.attrs.entries.length)return m(W.a,{text:app.translator.trans("sycho-action-log.admin.no_entries")});var t=this.attrs.controls.actions().icons;return m("div",{className:"ActionLogGrid"},this.attrs.entries.map((function(n){return m("div",{className:"ActionLogGrid-item"},m("div",{className:"ActionLogGrid-itemIcon"},m("div",{className:"ActionLogGrid-itemIconMain"},g()(t.resourceTypes[n.resourceType()]),m("span",{className:"ActionLogGrid-itemIconSecondary Badge",title:n.name(),oncreate:function(t){return $(t.dom).tooltip({placement:"bottom"})}},g()(t.actionNames[n.name()])))),m("div",{className:"ActionLogGrid-Avatar"},ot()(n.actor())),m("div",{className:"ActionLogGrid-itemContent"},m("div",{className:"ActionLogGrid-entryActor"},at()(n.actor())),m("div",{className:"ActionLogGrid-entryName"},n.formattedName),m("div",{className:"ActionLogGrid-entryDetails"},m("div",{className:"ActionLogGrid-entryType"},n.type()),m("div",{className:"ActionLogGrid-entryTime"},g()("far fa-clock")," ",tt()(n.createdAt())))))})))},n}(S.a),st=function(t){function n(){return t.apply(this,arguments)||this}s(n,t);var o=n.prototype;return o.oninit=function(n){t.prototype.oninit.call(this,n),this.entries=[],this.sortingOptions={newest:"-createdAt",oldest:"createdAt"},this.sort="newest",this.offset=0,this.limit=20,this.total=0,this.count=0,this.page=0,this.query=L()(""),this.controls=new K(this),this.load()},o.view=function(){return m("div",{className:"ActionLogPage"},m("div",{className:"ActionLogPage-header"},m("div",{className:"container"},m("h2",null,g()("fas fa-clipboard-list")," ",app.translator.trans("sycho-action-log.admin.title")),m("p",null,app.translator.trans("sycho-action-log.admin.description")),m("p",null,app.translator.trans("sycho-action-log.admin.total_entries",{count:this.total||"0"})),this.controls.mainControls(this).toArray())),m("div",{className:"ActionLogPage-content"},m("div",{className:"container"},m("div",{className:"ActionLogPage-navigation"},this.controls.filterControls(this).toArray()),m(it,{loading:this.loading,entries:this.entries,controls:this.controls}),m("div",{className:"ActionLogPage-navigation"},this.buildPagination()))))},o.load=function(t){var n=this;this.loading=!0,app.store.find("action-log-entries",this.requestParams(t||{})).then(this.handleResponse.bind(this)).then((function(){n.loading=!1,m.redraw()}))},o.requestParams=function(t){var n=t.offset,o=t.query,e=t.sort;return void 0!==n&&(this.offset=n),void 0!==e&&(this.sort=e),{page:{offset:this.offset,limit:this.limit},filter:{q:o},sort:this.sortingOptions[this.sort]}},o.handleResponse=function(t){var n=this;return this.entries=t,this.total=t.payload.meta.total||0,this.count=t.payload.meta.count||0,this.links=t.payload.links,this.page=Math.ceil(this.offset/this.limit),this.entries=this.entries.filter((function(t){return!(!n.isTagsEnabled()&&("tag"===t.resourceType()||"tagged"===t.name()))})),this.entries.map((function(t){t.formattedName=n.formatName(t)})),t},o.buildPagination=function(){return this.count<=this.limit?m("div",{className:"ActionLogPage-pagination"}):m("div",{className:"ActionLogPage-pagination"},m(v.a,{className:"Button Button--icon",icon:"fas fa-arrow-left",onclick:this.prev.bind(this),disabled:!this.hasPrev()}),m(N.a,{value:this.page,options:this.getPages(),onchange:this.changePage.bind(this)}),m(v.a,{className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:this.next.bind(this),disabled:!this.hasNext()}))},o.next=function(){this.hasNext()&&this.load({offset:this.offset+this.limit})},o.prev=function(){this.hasPrev()&&this.load({offset:this.offset-this.limit})},o.hasNext=function(){return this.offset+this.limit<this.count},o.hasPrev=function(){return this.links.prev},o.getPages=function(){var t=Array.from({length:Math.ceil(this.count/this.limit)},(function(t,n){return n+1}));return t.map((function(n,o){t[o]=app.translator.trans("sycho-action-log.admin.page",{number:n})})),t},o.changePage=function(t){Object.keys(this.getPages()).includes(t)&&this.load({offset:t*this.limit})},o.formatName=function(t){return new U(t).handle()},o.isTagsEnabled=function(){return-1!==JSON.parse(app.data.settings.extensions_enabled).indexOf("flarum-tags")},n}(d.a),rt=o(23),ct=o.n(rt),lt=o(24),ut=o.n(lt),mt=function(){app.routes["sycho-action-log"]={path:"/action-log",component:st},app.extensionSettings["sycho-action-log"]=function(){return m.route.set(app.route("sycho-action-log"))},Object(p.extend)(ct.a.prototype,"items",(function(t){return t.add("sycho-action-log",m(ut.a,{href:app.route("sycho-action-log"),icon:"fas fa-clipboard-list",description:app.translator.trans("sycho-action-log.admin.description")},app.translator.trans("sycho-action-log.admin.title"))),t}))},pt={"actionLog/components/ActionLogPage":st,"actionLog/components/Input":_,"actionLog/modals/ActionLogSettingsModal":G,"actionLog/modals/FiltersHelpModal":E,"actionLog/models/ActionLogEntry":u,"actionLog/utils/ActionLogControls":K},ft=o(25);i.a.initializers.add("sycho-action-log",(function(t){t.store.models["action-log-entries"]=u,mt()}),-90),e(ft.compat,pt)}]);
//# sourceMappingURL=admin.js.map